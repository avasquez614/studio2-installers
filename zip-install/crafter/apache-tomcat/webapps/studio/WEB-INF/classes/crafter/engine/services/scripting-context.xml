<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

    <bean id="crafter.groovyResourceConnector" class="org.craftercms.engine.scripting.impl.ContentResourceConnector">
        <property name="storeService" ref="crafter.contentStoreService" />
    </bean>

    <bean id="crafter.scriptFactory" class="org.craftercms.engine.scripting.impl.GroovyScriptFactory">
        <property name="resourceConnector" ref="crafter.groovyResourceConnector" />
        <property name="globalVariables" ref="crafter.restScriptsVariables" />
    </bean>

    <!--bean id="crafter.scriptFactory" class="org.craftercms.engine.scripting.impl.Jsr233CompiledScriptFactory">
        <property name="cacheTemplate" ref="crafter.cacheTemplate"/>
        <property name="storeService" ref="crafter.contentStoreService"/>
        <property name="globalVariables" ref="crafter.restScriptsVariables"/>
    </bean-->

    <bean id="crafter.pageScriptResolver" class="org.craftercms.engine.scripting.impl.ScriptResolverImpl">
        <property name="storeService" ref="crafter.contentStoreService"/>
        <property name="contentTypeXPathQuery" value="${crafter.engine.page.contentType.xpathQuery}"/>
        <property name="contentTypePattern" value="${crafter.engine.page.contentType.pattern}"/>
        <property name="scriptUrlFormat" value="${crafter.engine.page.contentType.script.url.format}"/>
        <property name="scriptsXPathQuery" value="${crafter.engine.scripts.xpathQuery}"/>
    </bean>

    <bean id="crafter.componentScriptResolver" class="org.craftercms.engine.scripting.impl.ScriptResolverImpl">
        <property name="storeService" ref="crafter.contentStoreService"/>
        <property name="contentTypeXPathQuery" value="${crafter.engine.component.contentType.xpathQuery}"/>
        <property name="contentTypePattern" value="${crafter.engine.component.contentType.pattern}"/>
        <property name="scriptUrlFormat" value="${crafter.engine.component.contentType.script.url.format}"/>
        <property name="scriptsXPathQuery" value="${crafter.engine.scripts.xpathQuery}"/>
    </bean>

    <util:map id="crafter.restScriptsVariables">
        <entry key="siteItemService" value-ref="crafter.siteItemService"/>
        <entry key="urlTransformationService" value-ref="crafter.urlTransformationService"/>
        <entry key="searchService" value-ref="crafter.searchService"/>
        <entry key="applicationContext" value-ref="crafter.applicationContextAccessor"/>
        <entry key="profileService" value-ref="crafter.profileServiceRestClient"/>
        <entry key="tenantService" value-ref="crafter.tenantServiceRestClient"/>
        <entry key="authenticationService" value-ref="crafter.authenticationServiceRestClient"/>
        <entry key="connectionFactoryLocator" value-ref="crafter.connectionFactoryLocator"/>
        <entry key="usersConnectionRepository" value-ref="crafter.usersConnectionRepository"/>
    </util:map>

</beans>